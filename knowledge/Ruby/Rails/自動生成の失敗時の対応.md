コラム 3.1.元に戻す方法
どれほど十分に気を付けていたとしても、Railsアプリケーションの開発中に何か失敗してしまうことはありえます。ありがたいことに、Railsにはそのような失敗をカバーする機能がいくつもあります。

一般的なシナリオの1つは、生成したコードを元に戻したい場合です。例えばコントローラを生成した後で、もっといいコントローラ名を思い付き、生成したコードを削除したくなった場合などです。リスト 3.7のように、Railsはコントローラ以外にも関連ファイルを大量に生成するので、生成されたコントローラファイルを削除するだけでは元に戻りません。自動生成されたコードを元に戻すためには、新規作成されたファイルを削除するだけではなく、既存のファイルに挿入されたコードも削除する必要があります。実際、2.2や2.3でも説明したように、rails generateを実行するとルーティングのroutes.rbファイルも自動的に変更されるので、これも元に戻さなくてはなりません。

このようなときは、「generate」（生成）と逆の意味を持つ、rails destroyというコマンドを実行することで元に戻せます。例えば次の2つのコマンドは、自動生成と、それに対応する取り消し処理の例です。

  $ rails generate controller StaticPages home help
  
  $ rails destroy  controller StaticPages home help
  
なお第6章でも、次のようにモデルを自動生成する方法を紹介します。

  $ rails generate model User name:string email:string

モデルの自動生成についても、同様の方法で元に戻すことができます。

  $ rails destroy model User

（上のコマンドからわかるように、モデル名以外の引数は不要です。その理由については第6章で説明します。）

また、第2章でも簡単に紹介しましたが、マイグレーションの変更を元に戻す方法も用意されています。

詳細は第6章で説明しますが、簡単に紹介すると、まずdb:migrateでデータベースのマイグレーションを変更します。

  $ rails db:migrate
元に戻したいときは、db:rollbackで1つ前の状態に戻します。

  $ rails db:rollback
最初の状態に戻したいときは、VERSION=0オプションを使います。

  $ rails db:migrate VERSION=0
ちなみに、上のコマンドのVERSION=0は、最初のシリアル番号、つまり最初に行ったマイグレーションに戻すという意味です。以前のRailsでは、ここに0以外のシリアル番号を指定すると、そのシリアル番号に該当する作成日時のマイグレーションに戻すことが可能でした。現在のマイグレーションは、VERSION=20220407092210のようにマイグレーションの作成日時のみ指定可能ですが、例外的にVERSION=0というシリアル番号だけは現在もサポートされています。

開発中に行き詰まってしまった場合でも、これらの機能を使えば元の状態を復元できます。
